<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Advanced R for Econometricians</title>
    <meta charset="utf-8" />
    <meta name="author" content="Martin C. Arnold" />
    <meta name="author" content="Jens Klenke" />
    <meta name="date" content="2022-02-10" />
    <script src="Introduction_files/header-attrs-2.8/header-attrs.js"></script>
    <link href="Introduction_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } },
      });
    </script>
    <style>
    .mjx-mrow a {
      color: black;
      pointer-events: none;
      cursor: default;
    }
    </style>
    <link rel="stylesheet" href="C:/Users/Jens-/Documents/GitHub/OEK_ARE/2021/assets/ude_fonts.css" type="text/css" />
    <link rel="stylesheet" href="C:/Users/Jens-/Documents/GitHub/OEK_ARE/2021/assets/ude.css" type="text/css" />
    <link rel="stylesheet" href="C:/Users/Jens-/Documents/GitHub/OEK_ARE/2021/assets/title_slides.css" type="text/css" />
    <link rel="stylesheet" href="C:/Users/Jens-/Documents/GitHub/OEK_ARE/2021/assets/custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">








class: class: title-slide title-rintro center middle

#  Advanced R for Econometricians
## Introduction
### Martin C. Arnold, Jens Klenke
---

## Preliminaries

.pull-left-1[**Contact Information:**  ]

.pull-right-2[
&lt;p&gt; &lt;span style="margin-bottom: -7px;"&gt;Jens Klenke &lt;/span&gt;&lt;span&gt;&lt;a href = "mailto: Jens.Klenke@vwl.uni-due.de"&gt;Jens.Klenke@vwl.uni-due.de&lt;/a&gt;&lt;/span&gt;&lt;/p&gt; 

&lt;p style="margin: 25px;"&gt;&lt;/p&gt;

&lt;p&gt; &lt;span style="margin-bottom: -7px;"&gt;Martin Arnold &lt;/span&gt;&lt;span&gt;&lt;a href = "mailto: Martin Arnold@vwl.uni-due.de"&gt;Martin.Arnold@vwl.uni-due.de&lt;/a&gt;]&lt;/span&gt;&lt;/p&gt; 
 


.pull-down[
&lt;br&gt;
Slides, exercises and announcements will be provided on: 
.center[
  https://moodle.uni-due.de/course/view.php?id=17174  
]
&lt;br&gt;
The password for the course is **"Hadley"**.  
&lt;br&gt;
On Moodle you will find a link to [Datacamp](https://www.datacamp.com) which will give you free access to all their content. 
]
???
Background? 
R and Rstudio installed? 
What do you know about R? 

---
## Grading

- There will be three graded assignments.  

- You will have to work on a final group project which focuses on one or more of the topics discussed in the course. 

- The final grade is a weighted average of the grades for the group project (60%), its presentation (20%) and
the assignments (20%).

- You have to pass each part (assignments, project and presentation) separately to pass the course. 
---
## Outline
.pull-left[
1. Introduction 
2. Prerequisites
   - Rmarkdown
   - Git and Github
3. Data Visualisation with ggplot 
3. Data Wrangling and Transformation
   - dplyr
   - databases
4. Advanced R Programming 
  - Functional Programming
  - Object Oriented Programming 
]
.pull-right[
&lt;ol start = "6"&gt;
&lt;li&gt;  Performance &lt;/li&gt; 
&lt;ul&gt;
  &lt;li&gt; Profiling and Benchmarking &lt;/li&gt; 
  &lt;li&gt; Parallelisation &lt;/li&gt;
  &lt;li&gt; Rcpp &lt;/li&gt;
&lt;/ul&gt;
&lt;li&gt; Web Scraping  &lt;/li&gt;
&lt;li&gt; &lt;i&gt;Shiny&lt;/i&gt; &lt;/li&gt;
&lt;li&gt;&lt;i&gt; Writing Packages&lt;/i&gt; &lt;/li&gt;
&lt;li&gt;&lt;i&gt; Text Mining&lt;/i&gt;  &lt;/li&gt;
&lt;/ol&gt;
]
---

class: top, left
## About R
- **Advantages:**
  - R is a language and environment for statistical computing and graphics.
  - R is highly extensible. There is a massive set of packages for statistical modelling, machine learning, visualisation, as well as importing and manipulating data. Researchers in statistics and machine learning often publish an R package to accompany their articles.
  - R is free and open source. 
  - R provides tools for communicating your results. R packages make it easy to produce html or pdf reports, or create interactive websites.
  - R is designed to connect to high-performance programming languages like C, Fortran, and C++.

--

- **Disadavantages:**
  - It is not very fast.
  - It has an inconsistent syntax.

---
class: top, left
## Sources

- [Advanced R](https://adv-r.hadley.nz/) by Hadley Wickham
- [R for Data Science](https://r4ds.had.co.nz) by Hadley Wickham and Garrett Grolemund
- The Art of R Programming by Norman Matloff
- The [Use R!](https://www.springer.com/series/6991) Series by Springer
- The [R Series](https://www.crcpress.com/go/the-r-series) by CRC Press

---
class: top, left
## Packages

- In R the fundamental unit of shareable code is the package.
- Chances are that someone has already solved a problem that youâ€™re working on, and you can benefit from their work by downloading their package.

#### The main sources for packages are:
  - CRAN (Comprehensive R Archive Network) with as of now ca. 15.000 available packages
  - GitHub (that is the place where packages are developed before getting published on CRAN) 
  - Bioconductor

---
class: top, left
## Installing Packages
.font80[
**How to install packages from CRAN?**

- Use `install.packages("MASS")` to install the package `MASS` from CRAN.
- Or using RStudio: Tools &amp;rarr; Install Packages &amp;rarr; `MASS`
]

--

.font80[
**How to install packages from Github?**

- Install the package `devtools` from CRAN.
- E.g., use `devtools::install_github("tidymodels/broom")` to install the `broom` package from Github.

- If you want to find out how a package works, search for

  - a vignette by the package authors 
  - a blog post about the package, e.g. on [R Bloggers](https://www.r-bloggers.com)
]

--

.font80[
.blockquote.exercise[

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example


```r
    library(broom)
    vignette("broom")
```

]]
---
class: top, left

## Getting Help

If you have specific questions about your code or an error message look on
  - [StackOverflow](https://stackoverflow.com/)  
  - [RStudio Community](https://community.rstudio.com/) (if it is about RStudio or packages developed by RStudio)
  - the [GitHub](https://github.com/) repository of the package maintainer

The chances are high that somebody else has already asked the same question and it has already been solved. 

--

If you don't find an answer you can ask a question yourself. What sounds easy is harder then one would think. Most importantly you have to provide a [reproducible example](https://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example).

???
Bad questions: 
https://stackoverflow.com/questions/58302656/how-can-i-set-equals-function-in-objective-of-solver-in-r-python
https://stackoverflow.com/questions/58121493/update-a-coordinate-dataframe-in-shiny 

Good questions:  
https://stackoverflow.com/questions/38777337/ggplot-ribbon-cut-off-at-y-limits/38777929#38777929 
https://stackoverflow.com/questions/53241120/how-to-use-openblas-lapacke-together-with-rcpp

---
## Rstudio

- RStudio is an integrated development environment (IDE) for R. 
- It provides some convenient functionality compared to the IDE shipping with R.

--

#### Rstudio Projects 

- To work in a specific directory the base R way would be to use `setwd()`. This is problematic if you want to 
  share your code or work from different machines on the same project. 
- Use projects instead.

--

#### Workflow

- Instead of opening a new R session and use `setwd()` you open the project. The working path is 
automatically set to the folder where the `.Rproj` file lives in. 

---
#### Some Shortcuts
&lt;p&gt;&lt;/p&gt;

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Shortcut &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Action &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Alt + Shift + k &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; list all shortcuts &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Cmd/Ctrl + Shift + F10 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; restart R &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Cmd/Ctrl + Shift + S &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; rerun current script &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; help page &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Ctrl + l &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clears the console &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

--

#### Rstudio supports: 
- package development
- version control via git and svm 
- creation and compilation of dynamic documents 
- connections to external data bases 
- ... 

We will use some of this later on.  

---
class: top, left

## R Basics

- We start by recapitulating some basics you should be familiar with when working with R. 
- An in-depth treatment of this material can be found in the first chapter of
[Advanced R](https://adv-r.hadley.nz/vectors-chap.html#introduction) by Hadley Wickham. 


---
class: top, left

## R Basics: Data Types and Data Structures
.font90[
We assume that you know about the basic data structures in R. 
  
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Homogeneous &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Heterogeneous &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1d &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Atomic Vector &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; List &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2d &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Matrix &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Data Frame &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; nd &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Array &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;br&gt;
] 

--

.font90[
You should also be familiar with the basic data types (character, double, integer, logical).

]

--
&lt;br&gt;

.font90[ .content-box-white[

**Task**

1. How is a list different from an atomic vector? 
2. How is a matrix different from a data frame?
3. How do you find out the type of an object?
4. How can you check if an object is of type character?

]]

???

```r
object.size(1:1000)
object.size(as.numeric(1:1000))

char_vector &lt;- c("Hi", "there")
typeof(char_vector)
class(char_vector)

num_matrix &lt;- matrix(rnorm(4), ncol = 2)
typeof(num_matrix)
class(num_matrix)
is.numeric(num_matrix)


plus &lt;- function(a, b){
  if(!is.numeric(a)) stop("a is not numeric")
  if(!is.numeric(b)) stop("b is not numeric")
  a + b
}

plus(1, "a")
```


---
class: top, left
## R Basics: Subsetting

You should know how to use the common subsetting operators  `[`, `[[` and `$`. 

Have you ever encountered `@`? 

--

&lt;br&gt;

&lt;div class = "content-box-white"&gt;

  &lt;strong&gt; Task &lt;/strong&gt;

  &lt;ol&gt;
    &lt;li&gt; What is the result of subsetting a vector with positive integers, negative integers, a logical vector, or a character vector? &lt;/li&gt; 
    &lt;li&gt; What is the difference between &lt;code&gt; [ &lt;/code&gt;,  &lt;code&gt; [[ &lt;/code&gt;, and &lt;code&gt; $ &lt;/code&gt; when applied to a list?  &lt;/li&gt;
    &lt;li&gt;  When should you use &lt;code&gt; drop = FALSE &lt;/code&gt; ? &lt;/li&gt;
  &lt;/ol&gt;

&lt;/div&gt;


???

```r
## Drop
m1 &lt;- matrix(1:4, nrow = 2)
m2 &lt;- matrix(1:4, nrow = 2)

matrix_prod &lt;- function(A, B){
  B %*% t(A)
}

matrix_prod(m1[1, ], m2)
matrix_prod(m1[1, , drop = FALSE], m2)

## Example for S4 class
N &lt;- 200
x.vec &lt;- as.vector(fGarch::garchSim(fGarch::garchSpec(rseed = 1985), n = N)[,1])
garch11 &lt;- fGarch::garchFit(~ garch(1,1), data = x.vec, trace = FALSE)

isS4(garch11)
```


---
## R Basics: Control Flows

The basic control flows are conditionals (choices) and loops.

.content-box-white[
**Task**

1. What is the difference between `if` and `ifelse()`?
2. What will be the value of `y` in the following code if `x` is `TRUE`? What if `x` is `FALSE`? What if `x` is `NA`?
    
    ```r
    y &lt;- if(x) 3
    ```
3. What is returned by the following code? 
    
    ```r
    switch("x", x = , y = 2, z = 3)
    ```
4. Name three kind of loops that can be implemented in R! How do they differ?
]

???


```r
if("2") 3
if(2) 3

for(i in 1:3){
  print(i)
}

i &lt;- 1
while(i &lt; 4){
  print(i)
  i &lt;- i + 1
}

i &lt;- 1
repeat{
  print(i)
  i &lt;- i + 1 
  if(i &gt; 3) break
  
}
```

---
class: top, left

## R Basics: Functions

.font90[
- Write a function that takes a number `x` and returns the square of `x`.  
]

#### Scoping

.font90[
- An important concept and also a source of trouble is scoping, the act of finding the value associated with a name. 
- R uses lexical scoping:  it looks up the values of names based on how a function is defined, not how it is called.
]

--

.blockquote.exercise[

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example: lexical scoping

.code90[

```r
f1 &lt;- function() x
x  &lt;- "global"
f2 &lt;- function(){
  x &lt;- "local_f2"
  f1()
}
f2()
```
]]
---
## Scoping Rules

Râ€™s lexical scoping follows four primary rules:
- Name masking
- Functions versus variables
- A fresh start
- Dynamic lookup

---
## Scoping Rules: Name Masking

.small[
.blockquote.exercise[ 

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example: What happens here?

```r
x &lt;- 3
square_1 &lt;- function() x^2
square_1()
```
]]

--
.small[
.blockquote.exercise[ 

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example: And here?


```r
x &lt;- 3
square_2 &lt;- function(){ 
  x   &lt;- 2
  foo &lt;- function() x^2
  foo()
}
square_2()
```
]]
--
.small[
- Names defined inside a function mask names defined outside a function.
]
---
## Scoping Rules: Functions versus Variables

.small[
.blockquote.exercise[ 

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example: Let's make things more confusing. Can you predict the result?   


```r
x &lt;- 3

square_2 &lt;- function(){ 
  x   &lt;- 2
  foo &lt;- function() x^2
  foo()
}

square_3 &lt;- function(x){
  square_2 &lt;- 5
  square_2()
}

square_3()
```
]]

--

- When a function and a non-function share the same name, R ignores non-function objects in a function call.

---
## Scoping Rules: A Fresh Start

.blockquote.exercise[ 

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example: What is the result of the first call to `square_4()`? What will happen the second time?


```r
x &lt;- 2
square_4 &lt;- function(){
  (x &lt;- x^2)
}

square_4()
square_4()
```
]

--

- Every time a function is called a new ***environment*** is created to host its execution. 
- A function has no way to tell what happened the last time it was run; each invocation is completely independent.

---
## Scoping Rules: Dynamic Lookup

.blockquote.exercise[ 

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example: Predict the result of the two calls to `f1()`. Compare it to the main rule of lexical scoping. 


```r
x  &lt;- 1
f1 &lt;- function() x
f1()

x &lt;- 2 
f1()
```
]

--

- R looks for values when the function is run, not when the function is created. 

---
## Lazy Evaluation

.blockquote.exercise[ .font90[ .code90[

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; What could cause an error here?

```r
lazy_function &lt;- function(x){
  10
}

lazy_function()
```
]]]

--

.font90[

Why does not it cause an error?
]

--

.blockquote.exercise[ .font90[.code90[


#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Function arguments are lazily evaluated; theyâ€™re only evaluated if accessed.


```r
lazy_function &lt;- function(x){
  x
}

lazy_function()
```

]]]

---
## Style Guide

#### Object names

.font70[
- Variable and function names should be lowercase.
- Use an underscore (_) to separate words within a name (as an alternative you can use camel case, but be consistent).
- Variable names should be nouns.
- Function names should be verbs.
- Strive for names that are concise and meaningful (this is not easy!).
- Where possible, avoid using names of existing functions and variables. 
]

--

.pull-left[ .code80[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:green;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"&gt;&lt;/path&gt;&lt;/svg&gt; Good


```r
day_one
day_1
```
]]]

--

.pull-right[
.code80[
.blockquote.exercise[ 

#### &lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"&gt;&lt;/path&gt;&lt;/svg&gt; Bad


```r
# Bad
first_day_of_the_month
dayone
djm1
T &lt;- FALSE
c &lt;- 10
mean &lt;- function(x) sum(x)
```
]]]

---
#### Spacing

.font80[
- Place spaces around all infix operators (`=`, `+`, `-`, `&lt;-`, etc.) and `=` in a function call.
- Always put a space after a comma, and never before.

]

.pull-left[ .code80[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:green;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"&gt;&lt;/path&gt;&lt;/svg&gt; Good

```r
average &lt;- mean(feet / 12 + inches, na.rm = TRUE)
```
]]]

.pull-right[ .code80[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"&gt;&lt;/path&gt;&lt;/svg&gt; Bad


```r
average&lt;-mean(feet/12+inches,na.rm=TRUE)
```
&lt;br&gt;
]]]

--

.font80[
- An exception to this rule are  `:`, `::` and `:::`.
]

.pull-left[ .code80[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:green;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"&gt;&lt;/path&gt;&lt;/svg&gt; Good

```r
x &lt;- 1:10
base::get
```
]]]

.pull-right[ .code80[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"&gt;&lt;/path&gt;&lt;/svg&gt; Bad


```r
x &lt;- 1 : 10
base :: get
```
]]]

---
#### Spacing

.font80[
- Extra spacing (i.e. more than one space in a row) is ok if it improves alignment of equal signs or assignments (`&lt;-`).
]

.code70[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example


```r
list(
  total = a + b + c, 
  mean  = (a + b + c) / n
)
```
]]

--

.font80[
- Do not place spaces around code in parentheses or square brackets (unless thereâ€™s a comma, in which case see above).
]

.pull-left[ .code70[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:green;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"&gt;&lt;/path&gt;&lt;/svg&gt; Good

```r
if (debug) do(x)
diamonds[5, ]
```
]]]

.pull-right[ .code70[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"&gt;&lt;/path&gt;&lt;/svg&gt; Bad

```r
if ( debug ) do(x)  # No spaces around debug
x[1,]   # Needs a space after the comma
x[1 ,]  # Space goes after comma not before
```
]]]

---
#### Spacing

- An opening curly brace should never go on its own line and should always be followed by a new line. A closing curly brace should always go on its own line, unless itâ€™s followed by else. Always indent the code inside curly braces.



.pull-left[ .blockquote.exercise[ 

#### &lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:green;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"&gt;&lt;/path&gt;&lt;/svg&gt;  Good


```r
if (y &lt; 0 &amp;&amp; debug) {
  message("Y is negative")
}

if (y == 0) {
  log(x)
} else {
  y ^ x
}
```
]]

--

.pull-right[ .blockquote.exercise[

#### &lt;svg viewBox="0 0 352 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"&gt;&lt;/path&gt;&lt;/svg&gt;  Bad

```r
if (y &lt; 0 &amp;&amp; debug) {
message("Y is negative") }

if (y == 0) {
  log(x)
} 
else {
  y ^ x
}
```
]]
---
#### Spacing

.font70[
- Itâ€™s okay to leave very short statements on the same line:
]

.code70[ .blockquote.exercise[

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example


```r
if (y &lt; 0 &amp;&amp; debug) message("Y is negative")
```
]]

.font70[
- Strive to limit your code to 80 characters per line. 
- If you find yourself running out of room, this is a good indication that you should encapsulate some of the work in a separate function.
]

--

#### Assignment

.font70[
- Use `&lt;-`, not `=`, for assignment.]

.pull-left[.code70[ .blockquote.exercise[
#### &lt;svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:green;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"&gt;&lt;/path&gt;&lt;/svg&gt; Good


```r
x &lt;- 5
```
]]]

.pull-right[.code70[ .blockquote.exercise[
#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Bad


```r
x = 5
```
]]]

---
#### Commenting guidelines

- Comment your code. 
- Each line of a comment should begin with the comment symbol and a single space: `#`. 
- Comments should explain the why, not the what.
- Use commented lines of `-` and `=` to break up your file into easily readable chunks.

--

.blockquote.exercise[

#### &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Example


```r
# Load data ---------------------------

# Plot data ---------------------------
```
]

---
class: exercise_slide

## &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Exercises

&lt;ol start = "1" &gt;
&lt;li&gt; Combine all elements of &lt;TT&gt;df_list&lt;/TT&gt; to one data frame. The result should be only a single line of code. &lt;/li&gt;
&lt;/ol&gt;

```r
df_list &lt;- lapply(0:4, function(j) data.frame(c1 = (1:5) + 5 * j,
                                              c2 = letters[(1:5) + 5 * j]
                                              )
                  )
```

&lt;ol start = "2" &gt;
&lt;li&gt; Fix each of the following common data frame subsetting errors: &lt;/li&gt;
&lt;/ol&gt;

```r
mtcars[mtcars$cyl = 4, ]
mtcars[-1:4, ]
mtcars[mtcars$cyl &lt;= 5]
mtcars[mtcars$cyl == 4 | 6, ]
```

&lt;ol start = "3" &gt;
&lt;li&gt;  What does &lt;TT&gt;df[is.na(df)] &lt;- 0&lt;/TT&gt; do? &lt;/li&gt;
&lt;/ol&gt;

&lt;ol start = "4" &gt;
&lt;li&gt;How would you randomly permute the columns of a data frame?&lt;/li&gt;
&lt;/ol&gt;

---
## &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Exercises

&lt;ol start = "5" &gt;
&lt;li&gt;Write a &lt;TT&gt;while&lt;/TT&gt; and a &lt;TT&gt;repeat&lt;/TT&gt; loop doing the same as &lt;/li&gt; 
&lt;/ol&gt;

```r
for(i in LETTERS[1:10]){
  print(i)
}
```
&lt;ol start = "6" &gt;
&lt;li&gt; Write a &lt;TT&gt;for&lt;/TT&gt; loop doing the same as&lt;/li&gt;
&lt;/ol&gt;


```r
count &lt;- 0
repeat{
  x     &lt;- sample(1:6, 1)
  count &lt;- count + 1 
  if(x == 6) break
}
print(count)
```

---
## &lt;svg viewBox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:#004c93;" xmlns="http://www.w3.org/2000/svg"&gt;  &lt;path d="M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"&gt;&lt;/path&gt;&lt;/svg&gt; Exercises


&lt;ol start = "7" &gt;
&lt;li&gt; .font90[What is the problem here? ] &lt;/li&gt;
&lt;/ol&gt;

.code80[

```r
# Number of apples
i &lt;- 100
for (i in 1:3) {} 
paste("The number of apples is", i)
```
]
&lt;ol start = "8" &gt;
&lt;li&gt; .font90[What is the problem here? Can you debug it?] &lt;/li&gt;
&lt;/ol&gt;
.code80[

```r
df &lt;- mtcars

lin_mod &lt;- function(){
  lm(y ~ . ,data = df)
}

simple_lin_mod &lt;- function(data, y, x){
  df &lt;- data[ ,c(y, x)]
  names(df) &lt;- c("y", "x")
  fast_lm()
}

simple_lin_mod(df, "mpg", "cyl")
```
]







    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../assets/remark-zoom.js"></script>
<script src="../xaringan_files/macros.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<script type="text/x-mathjax-config">
  
  function addCopyButtonToCode(){
    // get all code elements
    var allCodeBlocksElements = $( ".r" );
    // For each element, do the following steps
    allCodeBlocksElements.each(function(ii) {
      // define a unique id for this element and add it
      var currentId = "codeblock" + (ii + 1);
      $(this).attr('id', currentId);
      

      // add the button just after the text in the code block w/ jquery
      var clipButton = '<img src="../assets/clipboard-svgrepo-com.svg" width="20" alt="Copy to clipboard" onclick=copyToClipboard("#' + currentId + '") style="float:right;cursor:pointer;">';
      $(this).prepend(clipButton);
    });
    
  }

$(document).ready(function () {
  // Once the DOM is loaded for the page, attach clipboard buttons
  addCopyButtonToCode();
});


function copyToClipboard(element) {
  var $temp = $("<textarea>");
  $("body").append($temp);
  
  let vars = '';
  
  $(element).children().each((i, v) => {
      vars += $(v).text() + '\n'
    })
  
  $temp.val(vars).select();
  document.execCommand("copy");
  $temp.remove();
}

</script>




<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
