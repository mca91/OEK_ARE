---
title: "RMarkdown Solution"
author: "Martin Schmelzer"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(tidyverse)
library(gt)
library(gtsummary)
```

```{r DATA, cache=TRUE}
boston_crime <- readr::read_csv(here::here("SoSe_2025/Rmarkdown/Exercise/2025/BostonCrime.csv"))

crime_description <- readxl::read_xlsx(here::here("SoSe_2025/Rmarkdown/Exercise/2025/rmscrimeincidentfieldexplanation.xlsx"))
```




# Crime Incidents Report Data

```{r}
crime_description %>%
  separate_wider_regex(
    `Field Name, Data Type, Required`,
    patterns = c(
      `Field Name` = "^\\[.*?\\]",
      `Data Type` = "\\s?\\[\\w+\\]\\s?\\(.*?\\)",
      `Required` = "\\s?N?O?T? NULL"
    ), too_few = "align_start"
  ) %>%
  mutate(across(everything(), \(x) { gsub(pattern = "\\[|\\]", replacement = "", trimws(x)) } )) %>%
  gt(caption = "Field Description") %>%
  tab_options(column_labels.font.weight = "bold", table.font.size = px(8)) #%>%
  #gt::as_latex()
```

# Explorative Data Analysis

## Burglaries

```{r}
tbl_df <- boston_crime %>%
  filter(grepl(pattern = "BURGLARY", OFFENSE_DESCRIPTION)) %>%
  mutate(TimeOfDay = ifelse(HOUR < 12, "AM", "PM")) %>%
  select(TimeOfDay, DISTRICT)

summary_tbl <- tbl_df %>% 
  tbl_summary(
    by = TimeOfDay,
    statistic = list(
      all_categorical() ~ "{p}%"
    ),
    missing = "no"
  ) %>%
  add_overall() %>%
  bold_labels()

summary_tbl_df <- summary_tbl %>%
  as_tibble() %>%
  drop_na() %>%
  rename("C1" = 1, "C2" = 2, "C3" = 3, "C4" = 4) %>%
  mutate(across(2:4, parse_number))


gt_obj <- summary_tbl %>%
  as_gt() %>%
  gt::tab_caption("Burglary by District and Time of Day")


gt_obj
```

As can be seen above, district(s) `r summary_tbl_df %>% slice_max(n = 1, order_by = C2) %>% pull(C1) %>% paste0(collapse = " and ")` has/have the highest rates in burglaries overall. Between midnight and noon, district(s) `r summary_tbl_df %>% slice_max(n = 1, order_by = C3) %>% pull(C1) %>% paste0(collapse = " and ")` is/are at the top of the list.
From 12 p.m. on until midnight `r summary_tbl_df %>% slice_max(n = 1, order_by = C4) %>% pull(C1) %>% paste0(collapse = " and ")` marks the top spot.



##  Incidents by Day of the Week

```{r}
boston_crime %>%
  dplyr::mutate(DAY_OF_WEEK = as.factor(DAY_OF_WEEK)) %>%
  ggplot2::ggplot() +
  ggplot2::geom_bar(ggplot2::aes(x = DAY_OF_WEEK, fill = DISTRICT))
```




<!-- ## Nested ordered list for LaTeX output -->


<!-- \renewcommand{\labelenumii}{\theenumii} -->
<!-- \renewcommand{\theenumii}{\theenumi.\arabic{enumii}.} -->
<!-- \begin{enumerate} -->
<!--   \item Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. -->
<!--   \begin{enumerate} -->
<!--     \item Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. -->
<!--   \end{enumerate} -->
<!--   \item Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. -->
<!-- \end{enumerate} -->



